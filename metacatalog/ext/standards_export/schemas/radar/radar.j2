<?xml version="1.0" encoding="utf-8"?>
<v4w:v4w-content
    xmlns:v4w="http://kit.edu/schema/radar-v4w"
	xmlns:datacite="http://datacite.org/schema/kernel-3"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:dcmitype="http://purl.org/dc/dcmitype/"
	xmlns:dct="http://purl.org/dc/terms/"
	xmlns:file="http://radar-service.eu/schemas/descriptive/radar/v09/radar-file"
	xmlns:radar="http://radar-service.eu/schemas/descriptive/radar/v09/radar-dataset"
	xmlns:re="http://radar-service.eu/schemas/descriptive/radar/v09/radar-elements"
	xmlns:rtype="http://radar-service.eu/schemas/descriptive/radar/v09/radar-types"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
		http://kit.edu/schema/radar-v4w
		radar-v4w-extension.xsd">
    <v4w:variables>
        {% for variable in variables %}
		<v4w:variable>
			<v4w:variableName>{{ variable.name }}</v4w:variableName>
			<v4w:variableSymbol>{{ variable.symbol }}</v4w:variableSymbol>
			<v4w:unitName>{{ variable.unit.name }}</v4w:unitName>
			<v4w:unitSymbol>{{ variable.unit.symbol }}</v4w:unitSymbol>
		</v4w:variable>
        {% endfor %}
	</v4w:variables>
    {% if temporal_scales %}
    <v4w:temporalScales>
        {% for temporal_scale in temporal_scales %}
        <v4w:temporalScale>
            <v4w:temporalExtentStart>{{ temporal_scale.temporal_extent_start }}</v4w:temporalExtentStart>
            <v4w:temporalExtentEnd>{{ temporal_scale.temporal_extent_end }}</v4w:temporalExtentEnd>
            <v4w:temporalResolution>{{ temporal_scale.temporal_resolution_iso }}</v4w:temporalResolution>
        </v4w:temporalScale>
        {% endfor %}
    </v4w:temporalScales>
    {% endif %}
    <radar:radarDataset>
        {% for author in authors %}
        <re:creators>
            <re:creator>
                {% if author.last_name and author.first_name %}
                <re:creatorName>{{ author.last_name }}, {{ author.first_name }}</re:creatorName>
                {% if author.organisation_name %}
                <re:creatorAffiliation>{{ author.organisation_name }}</re:creatorAffiliation>
                {% endif %}
                {% elif author.organisation_name %}
                <re:creatorName>{{ author.organisation_name }}</re:creatorName>
                {% endif %}
            </re:creator>
        </re:creators>
        {% endfor %}
        <re:title>{{ title }}</re:title>
        <re:descriptions>
            <re:description descriptionType="Abstract">
            {{ abstract | indent(12) }}
            </re:description>
            {% if details_table %}
            <re:description descriptionType="Other">
            Details:
            {{ details_table | indent(12) }}
            </re:description>
            {% endif %}
        </re:descriptions>
        {% if keywords %}
        <re:keywords>
            {% for keyword in keywords %}
            {% if keyword.thesaurusName == "NASA/GCMD Earth Science Keywords" %}
            <re:keyword keywordScheme="Other" schemeURI="https://www.earthdata.nasa.gov/learn/find-data/idn/gcmd-keywords/">{{ keyword.full_path }}</re:keyword>
            {% else %}
            <re:keyword keywordScheme="Other">{{ keyword.full_path }}</re:keyword>
            {% endif %}
            {% endfor %}
        </re:keywords>
        {% endif %}
        <re:publishers>
            <re:publisher>{{ publisher.organisation_name }}</re:publisher>
        </re:publishers>
        {% if temporal_scales %}
        {% set temporal_extent_values = temporal_scales | get_temporal_extent_values %}
        {% if temporal_extent_values[0][0:4] == temporal_extent_values[1][0:4] %}
        <re:productionYear>{{ temporal_extent_values[0][0:4] }}</re:productionYear>
        {% elif temporal_extent_values[0][0:4] != temporal_extent_values[1][0:4] %}
        <re:productionYear>{{ temporal_extent_values[0][0:4] }}-{{ temporal_extent_values[1][0:4] }}</re:productionYear>
        {% endif %}
        {% else %}
        <re:productionYear>"unknown"</re:productionYear>
        {% endif %}
        <re:publicationYear>{{ publication[0:4] }}</re:publicationYear>
        <re:subjectAreas>
            <re:subjectArea>
                <re:controlledSubjectAreaName>Environmental Science and Ecology</re:controlledSubjectAreaName>
            </re:subjectArea>
        </re:subjectAreas>
        <re:resource resourceType="Dataset"/>
        <geoLocations>
            {% for bbox_location in bbox_locations %}
            <geoLocation>
                {% if bbox_location.min_lon == bbox_location.max_lon and bbox_location.min_lat == bbox_location.max_lat %}
                <geoLocationPoint>
                    <latitude>{{ bbox_location.min_lat }}</latitude>
                    <longitude>{{ bbox_location.min_lon }}</longitude>
                </geoLocationPoint> {% else %}
                <geoLocationBox>
                    <southWestPoint>
                        <latitude>{{ bbox_location.min_lat }}</latitude>
                        <longitude>{{ bbox_location.min_lon }}</longitude>
                    </southWestPoint>
                    <northEastPoint>
                        <latitude>{{ bbox_location.max_lat }}</latitude>
                        <longitude>{{ bbox_location.max_lon }}</longitude>
                    </northEastPoint>
                </geoLocationBox>{% endif %}        
            </geoLocation>
            {% endfor %}
        </geoLocations>
        <re:rights>
            {% for license in licenses %}
            {% if license.short_title in ("ODbL", "ODC-by", "CC BY 4.0", "CC BY-SA 4.0", "CC BY-NC 4.0", "CC BY-NC-SA 4.0") %}
            <re:controlledRights>{{ license.short_title | license_to_radar_license }}</re:controlledRights>
            {% else %}
            <re:controlledRights>{{ license.short_title | license_to_radar_license }}</re:controlledRights>
            <re:additionalRights>{{ license.short_title }}</re:additionalRights>
            {% endif %}
            {% endfor %}
        </re:rights>
        <re:rightsHolders>
            {# for now: first author or organization name, could potentially also be V-FOR-WaTer -> already publisher! #}
            {% if authors[0].last_name and authors[0].first_name %}
            <re:rightsHolder>{{ authors[0].first_name }}, {{ authors[0].last_name }}</re:rightsHolder>
            {% elif authors[0].organisation_name %}
            <re:rightsHolder>{{ authors[0].organisation_name }}</re:rightsHolder>
            {% endif %}
        </re:rightsHolders>
    </radar:radarDataset>
</v4w:v4w-content>